#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <locale.h>
#define L 3
#define C 3
#define T 20

typedef struct{
	char nome[20];
	int tam;
}tApp;

void carregar_Arquivos(tApp *p){
	FILE *leitura;
	int i=0;
	
	leitura = fopen("teste2.txt", "r");
	
	if(leitura == NULL){
		printf("Não possível abrir o arquivo.\n");
		exit(0);
	}
	else{
		while((fscanf(leitura,"%s %d\n", &p[i].nome,&p[i].tam))!= EOF){
			i++;
		}
	}
	
	fclose(leitura);
}

void organizar(tApp *v){
	int i,j;
	tApp aux;
	
	for(i=0;i<T;i++){
		for(j=0;j<T;j++){
			if(v[i].tam < v[j].tam && v[i].tam != 0){
				aux = v[i];
				v[i] = v[j];
				v[j] = aux;
			}
		}
	}	
}

void store(tApp *v){
	int resp,i,num;
	printf("---------------\n1 - Apps Disponíveis\n2 - Consultar\n0 - Voltar\n---------------\n");
	scanf(" %d", &resp);
	while(resp != 0){
		switch(resp){
			case 0:
				return;
			case 1:
				for(i=0;i<T;i++){
					if(v[i].tam != 0){
						printf("%d - %s\n", i+1,v[i].nome);
					}
				}
				printf("Digite o numero do App que deseja instalar: ");
				scanf("%d", &num);
				printf("App Instalado com sucesso\n");
				break;
			case 2:
				for(i=0;i<T;i++){
					if(v[i].tam != 0){
						printf("%s - Tamanho: %d\n", v[i].nome,v[i].tam);
					}
				}
			default:
				printf("Opção inválida!\n");
				break;
		}
		printf("---------------\n1 - Apps Disponíveis\n2 - Consultar\n0 - Voltar\n---------------\n");
		scanf(" %d", &resp);
	}
}

void menuprin(tApp *s){
	int resp;
	printf("---------------\n1 - Store\n2 - Apps Instalados\n3 - Apps em Execução\n---------------\n");
	scanf(" %d", &resp);
	while(resp != 0){
		switch(resp){
			case 1:
				store(s);
				break;
			case 2:
				//instalados();
				break;
			case 3:
				//execucao();
				break;
			default:
				printf("Opção inválida!\n");
				break;
		};
		printf("---------------\n1 - Store\n2 - Apps Instalados\n3 - Apps em Execução\n---------------\n");
		scanf(" %d", &resp);
	}
}

int main(){
	int i;
	setlocale(LC_ALL,"Portuguese");
	tApp apps_store[T],apps_instalados[T],apps_executando;
	
	for(i=0;i<T;i++){
		apps_store[i].tam = 0;
		apps_instalados[i].tam = 0;
		apps_executando[i].tam = 0;
		strcpy(apps_store[i].nome,"");
		strcpy(apps_instalados[i].nome,"");
		strcpy(apps_executando[i].nome,""); 
	}
	
	carregar_Arquivos(&apps_store[0]);
	organizar(&apps_store[0]);
	
	menuprin(&apps_store[0]);
	return 0;
}
